<form nz-form [formGroup]="form" nzLayout="vertical">
    <nz-card [nzTitle]="title1">
        <ng-template #title1>
            <i nz-icon type="user" class="icon text-danger" nzTheme="outline"></i>&nbsp;&nbsp; Bank Details
        </ng-template>
        <!-- <nz-divider nzText="Trading Bank" nzOrientation="left"></nz-divider> -->
        <div nz-row nzGutter="10" formGroupName="masterBank">
            <!--<div nz-col nzMd="12">-->
            <div nz-row nzGutter="5"  *ngIf="applicationStatus=='P' && HO">
                <button  nz-button nzType="primary" class='editButton' type="button" (click)="editButton()">Edit</button>
            </div>
            <div nz-row nzGutter="5">

                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label class="required">Client Name (As in bank proof ) </nz-form-label>
                        <nz-form-control>
                            <input formControlName="clntname" nz-input (keypress)="charrestrict($event)" class='upper' />
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label class="required">Bank Ac Type</nz-form-label>
                        <nz-form-control>
                            <nz-select formControlName="bankAcType" nzPlaceHolder="Choose"
                                [class.disabled]="applicationStatus=='P'||applicationStatus=='A'||applicationStatus=='T'">
                                <nz-option *ngFor="let item of tradingBankAccType" [nzValue]="item.AccountType"
                                    [nzLabel]="item.AccountType"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label>Mode of operation</nz-form-label>
                        <nz-form-control>
                            <nz-select formControlName="modeOfOperation"
                                [class.disabled]="applicationStatus=='P'||applicationStatus=='A'||applicationStatus=='T'">
                                <nz-option *ngFor="let item of ModeOfOperation" [nzValue]="item.Mode"
                                    [nzLabel]="item.Mode"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label class="required">IFSC Code</nz-form-label>
                        <nz-form-control>
                            <input nz-input (ngModelChange)="getIfscdetails($event)"
                                (keypress)="charrestrictAll($event)" formControlName="ifscCode" maxlength="11"
                                minlength="11" class='upper'/>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label class="required">Bank Name</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="bankname" class='upper'/>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label>MICR</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="micr" maxlength="9"
                                [textMask]="{mask: inputMasks.numeric}" class='upper'/>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <div nz-row nzGutter="5">
                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label class="required">Address</nz-form-label>
                        <nz-form-control>
                            <textarea nz-input rows="4" style="max-height: 80px;" formControlName="address"></textarea>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label class="required">Country</nz-form-label>
                        <nz-form-control>
                            <nz-form-control>
                                <input type="text" nz-input formControlName="country" [nzAutocomplete]="auto"
                                    (blur)="CheckCountryvalid($event)" />
                                <nz-autocomplete #auto>
                                    <nz-auto-option *ngFor="let option of resultArray" [nzValue]="option.Country"
                                        [nzLabel]="option.Country" class="aleternateColor">
                                        <span [innerHTML]="option.Country"></span>
                                    </nz-auto-option>
                                </nz-autocomplete>
                            </nz-form-control>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label class="required">State</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="state" (keypress)="charrestrict($event)" class='upper'/>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label class="required">City</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="city" class='upper'/>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label class="required">Pin</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="pin" [textMask]="{mask: inputMasks.numeric}"
                                maxlength="6" class='upper'/>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label class="required">Account Number</nz-form-label>
                        <nz-form-control>
                            <input nz-input type="password" formControlName="accntNumber" [class.disabled]="editFlag"
                                [textMask]="{mask: inputMasks.numeric}" minlength="4" class='upper'/>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label class="required">Confirm Account Number</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="confrmAccntNumber"
                                [textMask]="{mask: inputMasks.numeric}" class='upper'/>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4">
                    <nz-form-item>
                        <nz-form-label>Online Fund Transfer</nz-form-label>
                        <nz-form-control>
                            <nz-select formControlName="oft" nzPlaceHolder="Choose"
                                [class.disabled]="applicationStatus=='P'||applicationStatus=='A'||applicationStatus=='T'">
                                <nz-option [nzValue]="'Y'" nzLabel="Yes"></nz-option>
                                <nz-option [nzValue]="'N'" nzLabel="No"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4" [hidden]="hidRbidetails">
                    <nz-form-item>
                        <nz-form-label class="required">RBI Reference Number</nz-form-label>
                        <nz-form-control>
                            <input nz-input formControlName="rbirefNo" class='upper' maxlength="50"/>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4" [hidden]="hidRbidetails">
                    <nz-form-item>
                        <nz-form-label>RBI Approval Date</nz-form-label>
                        <nz-form-control>
                            <nz-date-picker formControlName="rbiapprvldt" [nzDisabledDate]="disabledFutureDate">
                            </nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzMd="4" [hidden]="hidRbidetails">
                    <nz-form-item>
                        <nz-form-label class="required">PIS Bank</nz-form-label>
                        <nz-form-control>
                            <nz-select formControlName="pisBank" nzPlaceHolder="Choose"
                                [class.disabled]="applicationStatus=='P'||applicationStatus=='A'||applicationStatus=='T'">
                                <nz-option *ngFor="let item of pisBankList" [nzValue]="item.BankCode"
                                    [nzLabel]="item.BankName"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <div nz-row nzGutter="5">
                <div nz-col nzMd="10">
                    <nz-form-item>
                        <nz-radio-group formControlName="BankAddoption" nzName="radiogroup" required>
                            <label nz-radio nzValue=0>Set As Primary</label>
                            <label nz-radio nzValue=1>Add New</label>
                            <label nz-radio nzValue=2>Update Existing</label>
                        </nz-radio-group>
                    </nz-form-item>
                </div>
            </div>
        </div>
        <app-file-preview [(isVisible)]="filePreiewVisible" [content]="filePreiewContent"
            [contentType]="filePreiewContentType" [fileName]="filePreiewFilename"></app-file-preview>
    </nz-card>
    <div *ngIf="tab=='Bank'" style="margin-top: 10px; margin-bottom: 10px;">
        <crf-image-upload></crf-image-upload>
    </div>
    <div nz-row nzGutter="5" formGroupName="Rejection">
        <div nz-col nzMd="15">
            <div nz-col nzSpan="5">
                <nz-form-label>{{Remks}}</nz-form-label>
            </div>
            <div nz-col nzSpan="15">
                <nz-form-item>
                    <nz-form-control>
                        <input nz-input formControlName="RejRemarks" [disabled]="applicationStatus!='P'&&!HO"
                            [nzAutocomplete]="remarks2" />
                        <nz-autocomplete #remarks2>
                            <nz-auto-option *ngFor="let option of rejectionRemarks" [nzValue]="option.Remarks"
                                [nzLabel]="option.Remarks" class="aleternateColor">
                                <span [innerHTML]="option.Remarks"></span>
                            </nz-auto-option>
                        </nz-autocomplete>

                    </nz-form-control>

                </nz-form-item>
            </div>
            <div *ngIf="applicationStatus=='P'">
                <div nz-col nzSpan="4">
                    <button nz-button nzType="primary" type="button" (click)="fetchReasons()"
                        title="Click here for Rejection Reasons">Select</button>
                </div>
            </div>
        </div>
        <div nz-col nzMd="9">
            <p class="text-right" *ngIf="tab=='Bank'">
                <button nz-button nzType="primary" type="button" (click)="onBackClick()">Back</button>
                <button nz-button nzType="primary" type="submit" (click)="SaveBank('save')"
                    *ngIf="saveButtonFlag&&applicationStatus!='T'">Save</button>
                <button nz-button nzType="primary" type="submit" (click)="SaveBank('savefinalise')"
                    *ngIf="saveButtonFlag&&applicationStatus=='T'">Save and Finalize</button>
                <button nz-button nzType="primary" type="button" (click)="BranchReject()"
                    *ngIf="saveButtonFlag&&applicationStatus=='T'&&!HO">Branch Reject</button>
                <button nz-button nzType="primary" type="button" *ngIf="approveOrRejectButtonFlag || finalApproveOrRejectButtonFlag"
                    (click)="Reject()">Reject</button>
                <button nz-button nzType="primary" type="button" *ngIf="approveOrRejectButtonFlag && editFlag"
                    (click)="initialApprove()">First level Approve</button>
                <button nz-button nzType="primary" class="btnApprove1" type="button" *ngIf="finalApproveOrRejectButtonFlag ||  (approveOrRejectButtonFlag && !editFlag)"
                    (click)="Approve()">Final Approve</button>
                <button nz-button nzType="primary" style="float: right;" type="button"
                    *ngIf="requestID!=''&&!(approveOrRejectButtonFlag ||finalApproveOrRejectButtonFlag) " (click)="PrintForm()">Print {{tab}} Form</button>
            </p>
        </div>
        <div *ngIf="checkBoxArray.length!=0 || AllcheckboxArray.length!=0">
            <table class="RejectedTable">
                <thead style="text-align: center; background-color: #32aa8d; color: white;">
                    <b>Rejected Reasons</b>
                </thead>
                <div *ngFor="let item of checkBoxArray; let i = index;">
                    <tbody _ngcontent-c61="">
                        <tr _ngcontent-c61="" class="ng-star-inserted">
                            <td class="Sno"><b>{{i+1}}</b>
                            </td>&nbsp;
                            <td _ngcontent-c61="" class="RejectedList">
                                <b> <input type="hidden" [checked]="checkBoxSelected"
                                        [disabled]="Cbox_Disabled">{{item.Description}}</b>
                            </td>
                        </tr>
                    </tbody>
                </div>
                <div *ngFor="let item of AllcheckboxArray; let i = index;">
                    <tbody _ngcontent-c61="">
                        <tr _ngcontent-c61="" class="ng-star-inserted">
                            <td class="Sno"><b>{{i+1}}</b>
                            </td>&nbsp;
                            <td _ngcontent-c61="" class="RejectedList">
                                <b> <input type="hidden" [checked]="checkBoxSelected"
                                        [disabled]="Cbox_Disabled">{{item}}</b>
                            </td>
                        </tr>
                    </tbody>
                </div>
            </table>
        </div>
        <br><br>
        <div *ngIf="applicationStatus=='R'&& reasonList.length!=0" class="rejectedReasonsData">
            <nz-table [nzData]="reasonList" [nzShowPagination]=false nzSize="default" class="tranTbl">
                <thead>
                    <tr>
                        <th>
                            <div style="margin-left: 34px;
                            word-break: normal;color: white;">Sl no</div>
                        </th>
                        <th>
                            <div style="margin-left: -75pc;
                            text-align: center;color: white;">Reasons</div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <div class="ReasonCheckbox reasons">
                        <tr _ngcontent-c61="" class="ng-star-inserted" *ngFor="let data of reasonList; let i = index">
                            <td class="checkBox">

                                <div><a><input class="Rcheckboxes" #saveUserNameCheckBox id="saveUserNameCheckBox"
                                            type="checkbox" [checked]="checkBoxSelect" (change)="changed($event,data)"
                                            [disabled]="applicationStatus=='R'" />
                                    </a>
                                </div>
                            </td>
                            <td class="Sno"><span>{{i+1}}</span>
                            </td>
                            <td _ngcontent-c61="">
                                <label><span> {{data.Description}}</span></label><br>
                            </td><br>
                        </tr>
                    </div>
                </tbody>
            </nz-table>
            <br>
        </div>
        <div nz-col nzMd="15" *ngIf="(applicationStatus=='P'||applicationStatus=='A'||applicationStatus=='R'||applicationStatus=='F')&&  !editFlag">
            <div nz-col nzSpan="5">Approval Remarks</div>
            <div nz-col nzSpan="15">
                <nz-form-item>
                    <nz-form-control>
                        <input nz-input formControlName="AppRemarks" [disabled]="applicationStatus!='P'&&!HO"
                            [nzAutocomplete]="remarks1" />
                        <nz-autocomplete #remarks1>
                            <nz-auto-option *ngFor="let option of approvelRemarks" [nzValue]="option.Remarks"
                                [nzLabel]="option.Remarks" class="aleternateColor">
                                <span [innerHTML]="option.Remarks"></span>
                            </nz-auto-option>
                        </nz-autocomplete>
                        <!-- <nz-select formControlName="country">
                            </nz-select> -->
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>
        <div *ngIf="applicationStatus=='P'">
            <div class="wrapper">
                <nz-modal [(nzVisible)]="isVisible" nzTitle="Rejection Reasons" (nzOnCancel)="isVisible=false"
                    (nzOnOk)="popOut()" nzWidth="850px" [nzBodyStyle]="{ height: '610px', 'padding-bottom':'53px' }"
                    [nzStyle]="{top:'8px'}">
                    <table>
                        <thead>
                            <div style="margin-top: 137%;">
                                <div class="SelectAll">
                                    <div *ngIf="checkBoxArray.length==0 || checkedArray.length==0">
                                        <div class="tooltip">
                                            <input #saveUserNameCheckBox id="saveUserNameCheckBox" type="checkbox"
                                                [checked]="checkBoxSelect" (change)="onSaveCheckBoxChanged($event)"
                                                [disabled]="applicationStatus=='R'" />
                                            <span class="tooltiptext">
                                                Proceed with this selection only if all the reasons provided below
                                                are
                                                applicable
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="modalserialno">
                                    <b>Sl No</b>
                                </div>
                                <div class="modalReasonList">
                                    <b>Reasons</b>
                                </div>
                            </div>
                        </thead>
                        <br>
                        <tbody class="">
                            <div class="ReasonCheckbox">
                                <div class="Popboxreasons ">
                                    <tr class="ant-modal-body" *ngFor="let data of reasonsList; let i = index;">

                                        <td>
                                            <div><a><input class="PopupcheckBox" #saveUserNameCheckBox
                                                        id="saveUserNameCheckBox" type="checkbox"
                                                        [checked]="checkboxSelected[i]" (change)="changed($event,data)"
                                                        [disabled]="applicationStatus=='R'" />
                                                </a></div>
                                        </td>
                                        <td><span class="SLno">{{i+1}}</span>
                                        </td>&nbsp;&nbsp;&nbsp;
                                        <td _ngcontent-c61="">
                                            <label><span class="RejectionList">{{data.Description}}</span></label><br>
                                        </td>
                                    </tr>
                                    <br>
                                </div>
                            </div>
                        </tbody>
                    </table>
                </nz-modal>
            </div>
        </div>
    </div>
</form>
<app-loader *ngIf="isSpining"></app-loader>